(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{x:()=>a});var t={baseUrl:"https://nomoreparties.co/v1/wbf-cohort-8",headers:{authorization:"44aacbb9-bcfb-4baf-9b17-25c42a7ed485","Content-Type":"application/json"}};function n(e,n){var r=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),o=r.querySelector(".card__like-button"),c=r.querySelector(".card__trash"),i=r.querySelector(".card__image"),u=r.querySelector(".card__title"),s=r.querySelector(".card__like-counter");return i.src=e.link,i.alt=e.name,u.textContent=e.name,s.textContent=e.likes.length,e.likes.find((function(e){return e._id===a}))?(o.classList.add("card__like-button_active"),o.addEventListener("click",(function(n){var r;n.target.classList.remove("card__like-button_active"),(r=e._id,fetch("".concat(t.baseUrl,"/cards/likes/").concat(r),{method:"DELETE",headers:t.headers})).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){s.textContent=e.likes.length}))}))):o.addEventListener("click",(function(n){var r;n.target.classList.toggle("card__like-button_active"),(r=e._id,fetch("".concat(t.baseUrl,"/cards/likes/").concat(r),{method:"PUT",headers:t.headers})).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){s.textContent=e.likes.length}))})),e.owner._id!==a?c.remove():c.addEventListener("click",(function(){var n;r.remove(),(n=e._id,fetch("".concat(t.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:t.headers})).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))})),i.addEventListener("click",(function(){return n(e.name,e.link)})),r}var r=function(e){"Escape"===e.key&&c(document.querySelector(".popup_opened"))};function o(e){e.classList.add("popup_opened"),document.addEventListener("keydown",r)}function c(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",r)}var a,i=".form",u=".form__field",s="form__button_inactive",l="hover-button",d="form__field_type_error",f="form__error_active",m=function(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(s),t.classList.add(l)):(t.classList.add(s),t.classList.remove(l))},v=document.querySelector(".elements__list"),_=document.querySelector(".profile__edit-button"),h=document.querySelector(".profile__add-button"),p=document.querySelectorAll(".form__button"),y=document.querySelector("#modal-profile"),b=document.querySelector("#modal-place"),k=document.querySelector("#modal-picture"),L=document.querySelector("#modal-avatar"),S=k.querySelector(".popup__image"),E=k.querySelector(".popup__name"),q=document.querySelector(".profile__name"),g=document.querySelector(".profile__bio"),j=document.querySelector(".profile__avatar"),C=document.forms["form-profile"],P=C.elements["full-name"],x=C.elements["job-description"],U=document.forms["form-place"],A=U.elements.title,O=U.elements.source,T=document.forms["form-avatar"],w=T.elements.avatar,D=document.querySelector(".profile__avatar-wrapper"),N=document.querySelector(".profile__avatar"),J=document.querySelectorAll(".popup__close-icon"),H=function(e,t){S.src=t,S.alt=e,E.textContent=e,o(k)};function z(e){e&&p.forEach((function(e){e.textContent="Сохранение..."}))}fetch("".concat(t.baseUrl,"/cards"),{headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){e.forEach((function(e){var t=n(e,H);v.append(t)}))})).catch((function(e){console.log(e)})),fetch("".concat(t.baseUrl,"/users/me"),{headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){q.textContent=e.name,g.textContent=e.about,j.src=e.avatar,a=e._id})).catch((function(e){console.log(e)})),U.addEventListener("submit",(function(e){e.preventDefault(),z(!0);var r,o,a={name:A.value,link:O.value};(r=a.name,o=a.link,fetch("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:r,link:o})})).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){var t=n(e,H);v.prepend(t),z(!1)})),c(b),U.reset()})),C.addEventListener("submit",(function(e){e.preventDefault(),z(!0),q.textContent=P.value,g.textContent=x.value,function(e,n){return fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:e,about:n})})}(P.value,x.value).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})),c(y)})),T.addEventListener("submit",(function(e){var n;e.preventDefault(),z(!0),(n=w.value,fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:n})})).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){N.src=e.avatar,z(!1)})),c(L),T.reset()})),h.addEventListener("click",(function(){return o(b)})),_.addEventListener("click",(function(){return o(y)})),D.addEventListener("click",(function(){return o(L)})),J.forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){return c(t)}))})),b.addEventListener("click",(function(e){e.target===b&&c(b)})),y.addEventListener("click",(function(e){e.target===y&&c(y)})),k.addEventListener("click",(function(e){e.target===k&&c(k)})),L.addEventListener("click",(function(e){e.target===L&&c(L)})),Array.from(document.querySelectorAll(i)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e){var t=Array.from(e.querySelectorAll(u)),n=e.querySelector(".form__button");m(t,n),t.forEach((function(r){r.addEventListener("input",(function(){(function(e,t){t.validity.valid?function(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(d),n.classList.remove(f),n.textContent=""}(e,t):function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(d),r.textContent=n,r.classList.add(f)}(e,t,t.validationMessage)})(e,r),m(t,n)}))}))}(e)}))})();